### Документация по работе с лабораторной работой №2

#### 1. Описание системы
Система представляет собой набор сервисов и баз данных, работающих вместе для обработки запросов и генерации отчетов:
- **API Gateway**: Обрабатывает аутентификацию и перенаправляет запросы к сервису `lab2`.
- **Сервис lab2**: Обрабатывает запросы к эндпоинту `/api/lab2/report`, извлекая данные из баз данных.
- **PostgreSQL**: Хранит данные о курсах, лекциях, студентах и группах.
- **Neo4j**: Хранит данные о расписании и связях между лекциями и аудиториями.
- **Redis**: Используется для кэширования количества студентов по курсам.

#### 2. Подготовка к работе
Перед началом убедитесь, что система настроена и запущена:
1. Запустите все контейнеры с помощью команды:
   ```bash
   podman compose up -d
   ```
2. Проверьте наличие данных в базах:
   - **PostgreSQL**: Таблицы `course_of_classes`, `class`, `schedule`, `students`, `student_groups`.
   - **Neo4j**: Узлы `Schedule`, `Class` и связи `FOR_CLASS`.
   - **Redis**: Кэш в формате `course:{course_id}:students`.

#### 3. Получение токена аутентификации
Для доступа к API нужен JWT-токен:
1. Выполните POST-запрос для получения токена:
   ```bash
   curl -X POST http://gateway:3001/api/token -H "Content-Type: application/json" -d '{"username":"vlad","password":"supersecret"}'
   ```
2. Сохраните токен в переменную:
   ```bash
   export TOKEN=<ваш_токен>
   ```

#### 4. Выполнение запроса к API
Для получения отчета отправьте запрос к эндпоинту `/api/lab2/report`:
1. Выполните POST-запрос с параметрами `semester` и `year`:
   ```bash
   curl -X POST http://gateway:3001/api/lab2/report -H "Content-Type: application/json" -H "Authorization: Bearer $TOKEN" -d '{"semester":1,"year":2023}'
   ```
2. Ожидаемый ответ — JSON с отчетом, содержащим информацию о курсах, лекциях, количестве студентов и требованиях к аудиториям.

#### 5. Логирование и отладка
Если возникли ошибки:
1. Проверьте логи сервиса `lab2`:
   ```bash
   podman logs lab2
   ```
2. Убедитесь, что данные в базах данных соответствуют запросу и синхронизированы.

#### 6. Обновление данных
Для обновления данных в Neo4j:
1. Выполните скрипт синхронизации:
   ```bash
   podman compose exec lab2 python /app/db_utils/neo4j/sync_neo4j_tables.py
   ```

#### 7. Остановка системы
Для завершения работы остановите контейнеры:
```bash
podman compose down
```